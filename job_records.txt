pose_err reduce for static img with original method/ours?
offline eval?
error_map?
check how the scaled depth and pose is setted up in the suppliments? checked, not well addressed. Hard reset depth scale--the learned pose scale is improper.
enforce consistency via mutiple paird input or design map_latent when enbale mutual is on?
predict_MM and reg_enforce_motion_flow_non_masked_area to be zero?---addtionally supervise of the pose.

disp_to_depth? the scales for depth and pose are related
enable_mutual(so that depth is computed for all the 3 imgs)+ST_head+ST_loss?---depth anything paper
unidepth v2 paper? disambigulate pose flow and motion flow grad flow.
use learned map latent? 3D mixer concept.



raft proof to be better? Yes
OF_curve pose reduced for dyn? Yes
reg_mag_motion_flow and motion_mask? Yes, Works if not using_MF(not sure effect when use_MF)---which to detach(either is okay as mask is gen from MF--this term can be removed if we use_MF_net?)? detach_motion_mask? function: avoid being lazy(especially when not use_MF_net)
loss_reproj_2? Yes, critial for supervise of the pose flow togther with effective motion_mask_with_grad
loss_reproj(with motion correction) might be redundant with use loss_repoj_2?
unfzD is necessary in the end? Yes. 
ignore_motion_area_at_calib? Only safer(as a lot are supervised with refined_tgt) but improper(try to turn off later) --as we use registered img to calibrate.

implement shared_MF_net? should be helpful.
test if diff poser can OF properly?



05.Sep: when 000=>010  reproj_err reduced further; pose err remains.
the pose_flow, consequently motin_flow are neither good.
(Done)95182: use seperate raft_like network to predict motion flow
colored_MotionCorrected_loss2nomo_000_fzD_b4_hardmask_RegMask_ignoreMotionAreaAtCalib_OFgtSup_raft_useMFnet
95256_b3: 95182+unfzD
(OOM)95224: 95182+unfzD
colored_MotionCorrected_loss2nomo_000_unfzD_b4_hardmask_RegMask_ignoreMotionAreaAtCalib_OFgtSup_raft_useMFnet



04.Sep: RAFT looks much better; we check all the vis--as we expected; but only rare cases when tool move fast--failed anyway
95012: pose_err not reduce; verify if the dataset issue: tool_motion break the OF application case
colored_MotionCorrected_loss2nomo_000_fzD_b4_hardmask_RegMask_ignoreMotionAreaAtCalib_OFgtSup_raft_010
XXX95181: use 011. Sanity_for_sure_should_reduce.  Nan. Why?

#////////////////////////////////
03.Sep: inspect calib process; 
fzD; loss_0_using_gt_supervision; binarymask; regMask_on
94924(10h) --model_name colored_MotionCorrected_loss2nomo_000_fzD_b4_hardmask_RegMask_ignoreMotionAreaAtCalib_OFgtSup \
OF seems in low accuracy: 94924+Raft OF, inspect if OF arch is a bottlneck.
94927(10h) --model_name colored_MotionCorrected_loss2nomo_000_fzD_b4_hardmask_RegMask_ignoreMotionAreaAtCalib_OFgtSup \


02.Sep: unfz still not work despite with improved motion_mask_reg; refined_img_have_issue! Bimask > Gray_mask

94513 (94519 b1 version)colored_MotionCorrected_loss2nomo_000_fzD_b4_softmaskRegMF_contrasiveFlowMag_correct: soft+MF_reg+New_flow_mag_norm + fz
x94514 (94522 94526 b1 version) colored_MotionCorrected_loss2nomo_000_unfzD_b4_hardmaskRegMF_contrasiveFlowMag_correct: soft+MF_reg+New_flow_mag_norm (more step further)

#loss priority only if 94513 works: baseline
X94527 colored_MotionCorrected_loss2nomo_000_fzD_b4_hardRegMF_contrasiveFlowMag_baseline: hard+MF_reg+New_flow_mag_norm + fz



94473 b1 quick_trn: see if the soft motion mask is making sense: 
    colored_MotionCorrected_loss2nomo_000_fzD_b1_accu4_softmaskRegMF_correct is making sense. colored_MotionCorrected_loss2nomo_000_unfzD_b1_accu4_softmaskRegMF_correct
/////colored_MotionCorrected_loss2nomo_000_unfzD_b4_softmaskRegPF_correct: 94466(10h) 94452(15h) a100



31.Aug

/////colored_MotionCorrected_loss2nomo_000_fzD_b4_softmaskReg_correct: 94231(15h) a100
/////colored_MotionCorrected_loss2nomo_000_unfzD_b4_softmaskReg_correct: 94234(15h) a100

# we expect to unfreeze depth with the help of reg term
/////colored_MotionCorrected_loss2nomo_000_fzD_b4(wrongname_actualb1)_accu4_softmaskReg_correct: X94232 v100 quick results
/////colored_MotionCorrected_loss2nomo_000_unfzD_b4(wrongname_actualb1)_accu4_softmaskReg_correct: X94233 v100 quick results


/////colored_MotionCorrected_loss2nomo_000_fzD_b1_correct: 93977  b1_accu4 93865+freeze_depth# quick resullts
/////colored_MotionCorrected_loss2nomo_000_fzD_b4_correct:  X93972(20h. alright but the pose_err can not further reduced after iter 4k) 93995(4h)  93865+freeze_depth
/////colored_MotionCorrected_loss2nomo_000_fzD_b4(wrongly named, we forget enable loss2): 93923(2h)  92405+freeze_depth

/////colored_MotionCorrected_loss2nomo_000_b1: 93876  v100 use addtionaly loss_reprj2 on static area only
/////colored_MotionCorrected_loss2nomo_000_b4: 93865 use addtionaly loss_reprj2 on static area only--still depth zero
/////colored_MotionCorrected_woAF_dynascared_000_b4: 93663  a100---still depth became zeor--not batch_size_issue

/////colored_MotionCorrected_woAF_dynascared_000: 93580  batch_size 4 a100

30.Aug 

Motion_EXPx: need good OF
Motion_EXP1: 
/////colored_MotionCorrected_woAF_dynascared_000: 92403  batch_size 1 rtxa5000
    options.enable_motion_computation = True
    options.reproj_supervised_which = "color_MotionCorrected"
    options.reproj_supervised_with_which = "raw_tgt_gt"
    options.flow_reproj_supervised_with_which = "raw_tgt_gt"
    options.transform_constraint = 0.0
    options.transform_smoothness = 0.0
-expect solved the motion properly for the first time by using 'color_MotionCorrected'
-do not consider AF yet
/////colored_MotionCorrected_dynascared_000: 92405  batch_size 1 rtxa5000
    options.enable_motion_computation = True
    options.reproj_supervised_which = "color_MotionCorrected"
-better than the above baseline in term of AF

////TODO:
DUST3R with pts3d + diffposer/Marepo_head
DUST3R with shared opticflow?
Video_depth
video depth injection to DPT

////TODO:
eval_code on traj.


90487 fast3r_retrained: /mnt/ceph/tco/TCO-Staff/Homes/jinjing/slurm_out --num_epochs 10 --batch_size 4 --log_frequency 200 
90584 fast3r_dynascared_000: /mnt/ceph/tco/TCO-Staff/Homes/jinjing/slurm_out --num_epochs 10 --batch_size 4 --log_frequency 200 

# help motion mask gen
get_texu_mask